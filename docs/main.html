
<!DOCTYPE html>

<html>
<head>
    <title>main.go</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="gocco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <table cellpadding="0" cellspacing="0">
      <thead>
        <tr>
          <th class="docs">
            <h1>
                main.go
            </h1>
          </th>
          <th class="code">
          </th>
        </tr>
      </thead>
      <tbody>
          
          <tr id="section-1">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
                <p><strong>shutter</strong> builds EBS snapshots.
It was written because I didn&rsquo;t want the extreme hassle of
installing Perl/Python dependencies for ec2-consistent-snapshot or
its descendents.</p>

<p>Support for freezing and restoring XFS partitions is included.</p>

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&quot;./util&quot;</span>
	<span class="s">&quot;flag&quot;</span>
	<span class="s">&quot;fmt&quot;</span>
	<span class="s">&quot;github.com/mitchellh/goamz/aws&quot;</span>
	<span class="s">&quot;github.com/mitchellh/goamz/ec2&quot;</span>
	<span class="s">&quot;os&quot;</span>
	<span class="s">&quot;os/exec&quot;</span>
	<span class="s">&quot;sync&quot;</span>
<span class="p">)</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-2">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
                <p>Custom type for multiple command line-specified strings.</p>

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="kd">type</span> <span class="nx">stringslice</span> <span class="p">[]</span><span class="kt">string</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">v</span> <span class="o">*</span><span class="nx">stringslice</span><span class="p">)</span> <span class="nx">String</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%#v&quot;</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">v</span> <span class="o">*</span><span class="nx">stringslice</span><span class="p">)</span> <span class="nx">Set</span><span class="p">(</span><span class="nx">value</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="o">*</span><span class="nx">v</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="o">*</span><span class="nx">v</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span>
	<span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-3">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
                <p>Freeze the requested filesystems.</p>

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="kd">func</span> <span class="nx">freeze</span><span class="p">(</span><span class="nx">mountpoints</span> <span class="p">[]</span><span class="kt">string</span><span class="p">,</span> <span class="nx">logger</span> <span class="nx">util</span><span class="p">.</span><span class="nx">Logger</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">w</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
	<span class="nx">w</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">mountpoints</span><span class="p">))</span>

	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">mp</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">mountpoints</span> <span class="p">{</span>
		<span class="k">go</span> <span class="kd">func</span><span class="p">(</span><span class="nx">partition</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">logger</span><span class="p">.</span><span class="nx">Debugf</span><span class="p">(</span><span class="s">&quot;freezing %s for the snapshots.&quot;</span><span class="p">,</span> <span class="nx">partition</span><span class="p">)</span>
			<span class="nx">cmd</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;xfs_freeze&quot;</span><span class="p">,</span> <span class="s">&quot;-f&quot;</span><span class="p">,</span> <span class="nx">partition</span><span class="p">)</span>
			<span class="nx">cmd</span><span class="p">.</span><span class="nx">Run</span><span class="p">()</span>

			<span class="nx">output</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">cmd</span><span class="p">.</span><span class="nx">Output</span><span class="p">()</span>
			<span class="nx">logger</span><span class="p">.</span><span class="nx">Debugf</span><span class="p">(</span><span class="s">&quot;%s debug: %s&quot;</span><span class="p">,</span> <span class="nx">partition</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">output</span><span class="p">))</span>
			<span class="nx">w</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
		<span class="p">}(</span><span class="nx">mp</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">w</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
<span class="p">}</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-4">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
                <p>Unfreeze the requested filesystems.</p>

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="kd">func</span> <span class="nx">unfreeze</span><span class="p">(</span><span class="nx">mountpoints</span> <span class="p">[]</span><span class="kt">string</span><span class="p">,</span> <span class="nx">logger</span> <span class="nx">util</span><span class="p">.</span><span class="nx">Logger</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">w</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
	<span class="nx">w</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">mountpoints</span><span class="p">))</span>

	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">mp</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">mountpoints</span> <span class="p">{</span>
		<span class="k">go</span> <span class="kd">func</span><span class="p">(</span><span class="nx">partition</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">logger</span><span class="p">.</span><span class="nx">Debugf</span><span class="p">(</span><span class="s">&quot;unfreezing %s now that snapshots are complete.&quot;</span><span class="p">,</span> <span class="nx">partition</span><span class="p">)</span>
			<span class="nx">cmd</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;xfs_freeze&quot;</span><span class="p">,</span> <span class="s">&quot;-u&quot;</span><span class="p">,</span> <span class="nx">partition</span><span class="p">)</span>
			<span class="nx">cmd</span><span class="p">.</span><span class="nx">Run</span><span class="p">()</span>

			<span class="nx">output</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">cmd</span><span class="p">.</span><span class="nx">Output</span><span class="p">()</span>
			<span class="nx">logger</span><span class="p">.</span><span class="nx">Debugf</span><span class="p">(</span><span class="s">&quot;%s debug: %s&quot;</span><span class="p">,</span> <span class="nx">partition</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">output</span><span class="p">))</span>
			<span class="nx">w</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
		<span class="p">}(</span><span class="nx">mp</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">w</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">logger</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">util</span><span class="p">.</span><span class="nx">NewColourizedOutputLogger</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdout</span><span class="p">)</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-5">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
                <p><strong>-region:</strong> only required if not running on an EC2 instance.</p>

            </td>
            <td class="code">
                <div class="highlight"><pre>	<span class="kd">var</span> <span class="nx">region</span> <span class="kt">string</span>
	<span class="nx">flag</span><span class="p">.</span><span class="nx">StringVar</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">region</span><span class="p">,</span> <span class="s">&quot;region&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;EC2 region to look for EBS volumes in.&quot;</span><span class="p">)</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-6">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
                <p><strong>-volume[]:</strong> Can be specified multiple times.
Defines the volumes that we are backing up.</p>

            </td>
            <td class="code">
                <div class="highlight"><pre>	<span class="kd">var</span> <span class="nx">volumes</span> <span class="nx">stringslice</span>
	<span class="nx">flag</span><span class="p">.</span><span class="nx">Var</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">volumes</span><span class="p">,</span> <span class="s">&quot;volume&quot;</span><span class="p">,</span> <span class="s">&quot;List of volumes to snapshot.&quot;</span><span class="p">)</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-7">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
                <p><strong>-description[]:</strong> Can be specified multiple times.
Defines the description of the matching volume.</p>

<p>If only one description is given it is applied to all snapshots.
You must either define only one, or match all volumes.
All other conditions are errors.</p>

            </td>
            <td class="code">
                <div class="highlight"><pre>	<span class="kd">var</span> <span class="nx">descriptions</span> <span class="nx">stringslice</span>
	<span class="nx">flag</span><span class="p">.</span><span class="nx">Var</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">descriptions</span><span class="p">,</span> <span class="s">&quot;description&quot;</span><span class="p">,</span> <span class="s">&quot;List of descriptions to give snapshots.&quot;</span><span class="p">)</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-8">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
                <p><strong>-partition[]:</strong> XFS partitions that should be frozen and
unfrozen as a part of this snapshot.</p>

            </td>
            <td class="code">
                <div class="highlight"><pre>	<span class="kd">var</span> <span class="nx">partitions</span> <span class="nx">stringslice</span>
	<span class="nx">flag</span><span class="p">.</span><span class="nx">Var</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">partitions</span><span class="p">,</span> <span class="s">&quot;partition&quot;</span><span class="p">,</span> <span class="s">&quot;XFS partition to freeze/un-freeze.&quot;</span><span class="p">)</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-9">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
                <p>Add in a debug flag to show detailed logging output for diagnosis.</p>

            </td>
            <td class="code">
                <div class="highlight"><pre>	<span class="kd">var</span> <span class="nx">debugMode</span> <span class="kt">bool</span>
	<span class="nx">flag</span><span class="p">.</span><span class="nx">BoolVar</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">debugMode</span><span class="p">,</span> <span class="s">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="s">&quot;Enable debug output in logs.&quot;</span><span class="p">)</span>

	<span class="nx">flag</span><span class="p">.</span><span class="nx">Parse</span><span class="p">()</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-10">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
                <p>Enable debug mode if the user has requested it.</p>

            </td>
            <td class="code">
                <div class="highlight"><pre>	<span class="nx">logger</span><span class="p">.</span><span class="nx">SetDebugOutput</span><span class="p">(</span><span class="nx">debugMode</span><span class="p">)</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-11">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
                <p>Do some sanity-checking on the arguments we&rsquo;re given.
<strong>TODO(silversupreme):</strong> Add in support for figuring out what
region to use from the EC2 instance metadata.</p>

            </td>
            <td class="code">
                <div class="highlight"><pre>	<span class="k">if</span> <span class="nx">region</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="p">{</span>
		<span class="nx">logger</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="s">&quot;You did not specify a region!&quot;</span><span class="p">)</span>
		<span class="k">return</span>
	<span class="p">}</span>

	<span class="nx">awsRegion</span><span class="p">,</span> <span class="nx">present</span> <span class="o">:=</span> <span class="nx">aws</span><span class="p">.</span><span class="nx">Regions</span><span class="p">[</span><span class="nx">region</span><span class="p">]</span>
	<span class="k">if</span> <span class="p">!</span><span class="nx">present</span> <span class="p">{</span>
		<span class="nx">logger</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;Given region %s not a supported AWS region!&quot;</span><span class="p">,</span> <span class="nx">region</span><span class="p">)</span>
		<span class="k">return</span>
	<span class="p">}</span>

	<span class="nx">logger</span><span class="p">.</span><span class="nx">Debugf</span><span class="p">(</span><span class="s">&quot;Backing up volumes in %s region.&quot;</span><span class="p">,</span> <span class="nx">region</span><span class="p">)</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-12">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
                <p>Check that the number of descriptions and volumes match up.</p>

            </td>
            <td class="code">
                <div class="highlight"><pre>	<span class="nx">numDescriptions</span> <span class="o">:=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">descriptions</span><span class="p">)</span>
	<span class="nx">numVolumes</span> <span class="o">:=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">volumes</span><span class="p">)</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-13">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
                <p><strong>TODO(silversupreme):</strong> Make this instead use all volumes
attached to the currently-running instance, if we can.</p>

            </td>
            <td class="code">
                <div class="highlight"><pre>	<span class="k">if</span> <span class="nx">numVolumes</span> <span class="p">&lt;</span> <span class="mi">1</span> <span class="p">{</span>
		<span class="nx">logger</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="s">&quot;No volumes specified!&quot;</span><span class="p">)</span>
		<span class="k">return</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="nx">numDescriptions</span> <span class="o">!=</span> <span class="mi">1</span> <span class="p">{</span>
		<span class="k">if</span> <span class="nx">numDescriptions</span> <span class="o">!=</span> <span class="nx">numVolumes</span> <span class="p">{</span>
			<span class="nx">logger</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;Mis-matched %d descriptions to %d volumes!&quot;</span><span class="p">,</span> <span class="nx">numDescriptions</span><span class="p">,</span> <span class="nx">numVolumes</span><span class="p">)</span>
			<span class="k">return</span>
		<span class="p">}</span>
	<span class="p">}</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-14">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
                <p>Gather up all of the volumes and their descriptions.</p>

            </td>
            <td class="code">
                <div class="highlight"><pre>	<span class="nx">volumesToSnapshot</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{}</span>
	<span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">volumes</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">thisDescription</span> <span class="kt">string</span>

		<span class="k">if</span> <span class="nx">numDescriptions</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">{</span>
			<span class="nx">thisDescription</span> <span class="p">=</span> <span class="nx">descriptions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nx">thisDescription</span> <span class="p">=</span> <span class="nx">descriptions</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
		<span class="p">}</span>

		<span class="nx">volumesToSnapshot</span><span class="p">[</span><span class="nx">value</span><span class="p">]</span> <span class="p">=</span> <span class="nx">thisDescription</span>
	<span class="p">}</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-15">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
                <p>Connect to EC2 and make sure everything is alright there.</p>

            </td>
            <td class="code">
                <div class="highlight"><pre>	<span class="nx">credentials</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">aws</span><span class="p">.</span><span class="nx">GetAuth</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">logger</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;Auth failure: %s&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">())</span>
		<span class="k">return</span>
	<span class="p">}</span>

	<span class="nx">ec2_conn</span> <span class="o">:=</span> <span class="nx">ec2</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">credentials</span><span class="p">,</span> <span class="nx">awsRegion</span><span class="p">)</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-16">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
                <p>Freeze the requested filesystem.</p>

            </td>
            <td class="code">
                <div class="highlight"><pre>	<span class="nx">freeze</span><span class="p">(</span><span class="nx">partitions</span><span class="p">,</span> <span class="nx">logger</span><span class="p">)</span>
	<span class="k">defer</span> <span class="nx">unfreeze</span><span class="p">(</span><span class="nx">partitions</span><span class="p">,</span> <span class="nx">logger</span><span class="p">)</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-17">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
                <p>Create snapshots of the requested volumes, in parallel.
Skip over any that are not actually present in EC2.</p>

            </td>
            <td class="code">
                <div class="highlight"><pre>	<span class="kd">var</span> <span class="nx">w</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
	<span class="nx">w</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="nx">numVolumes</span><span class="p">)</span>

	<span class="k">for</span> <span class="nx">volumeId</span><span class="p">,</span> <span class="nx">desc</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">volumesToSnapshot</span> <span class="p">{</span>
		<span class="k">go</span> <span class="kd">func</span><span class="p">(</span><span class="nx">volumeId</span><span class="p">,</span> <span class="nx">desc</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-18">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
                <p>Create the snapshot if we can.</p>

            </td>
            <td class="code">
                <div class="highlight"><pre>			<span class="nx">logger</span><span class="p">.</span><span class="nx">Debugf</span><span class="p">(</span><span class="s">&quot;Creating snapshot for %s&quot;</span><span class="p">,</span> <span class="nx">volumeId</span><span class="p">)</span>

			<span class="nx">resp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ec2_conn</span><span class="p">.</span><span class="nx">CreateSnapshot</span><span class="p">(</span><span class="nx">volumeId</span><span class="p">,</span> <span class="nx">desc</span><span class="p">)</span>
			<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
				<span class="nx">logger</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;Could not create snapshot for %s: %s&quot;</span><span class="p">,</span> <span class="nx">volumeId</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
				<span class="nx">w</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
				<span class="k">return</span>
			<span class="p">}</span>

			<span class="nx">logger</span><span class="p">.</span><span class="nx">Successf</span><span class="p">(</span><span class="s">&quot;Created snapshot %s for %s&quot;</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Snapshot</span><span class="p">.</span><span class="nx">Id</span><span class="p">,</span> <span class="nx">volumeId</span><span class="p">)</span>
			<span class="nx">w</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
		<span class="p">}(</span><span class="nx">volumeId</span><span class="p">,</span> <span class="nx">desc</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">w</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>

	<span class="nx">logger</span><span class="p">.</span><span class="nx">Infof</span><span class="p">(</span><span class="s">&quot;Done!&quot;</span><span class="p">)</span>
<span class="p">}</span>

</pre></div>
            </td>
          </tr>
          
      </tbody>
    </table>
  </div>
</body>
</html>
